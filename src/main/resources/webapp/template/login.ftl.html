<!--
#
# Copyright (c) 2014, Deem Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
-->
<#import "layouts/login-layout.ftl.html" as main>
<@main.page>

<div class="container">

    <form method="post" action="/cms-ability/zkui/login" onsubmit="encryptForm()">
        <div class="row">
            <div class="col-md-4">
                &nbsp;
            </div>
            <div class="col-md-4">
                <h2 class="text-center">配置中心</h2>
                <input type="text" id="username" name="username" class="form-control" placeholder="账号" required autofocus>
                <br/>
                <input type="password" id="password" name="password" class="form-control" placeholder="密码" required>
                <br/>
                <div style="white-space: nowrap;">
                    <input type="text" name="code" value="" class="form-control col-md-4" placeholder="验证码" required autofocus/>
                    <img onclick="javascript:getvCode()" id="verifyimg" style="margin-left: 20px;"/>
                </div>
                <br/>
                <input type="submit" name="action" value="登录" class="btn btn-lg btn-primary btn-block"/>
                <br/>
<!--                <#if loginMessage??>-->
<!--                <p class="text-success text-center">${loginMessage}</p>-->
<!--                <br/>-->
<!--                </#if> -->

                <#if flashMsg??>
                <p class="text-danger text-center">${flashMsg}</p>
                </#if>
            </div>
            <div class="col-md-4">
                &nbsp;
            </div>
        </div>

    </form>

</div> <!-- /container -->
</@main.page>
<script type="text/javascript">
    getvCode();

    /**
     * 获取验证码
     * 将验证码写到login.html页面的id = verifyimg 的地方
     */
    function getvCode() {
        document.getElementById("verifyimg").src = timestamp("/cms-ability/zkui/verifyCode");
    }
    //为url添加时间戳
    function timestamp(url) {
        var getTimestamp = new Date().getTime();
        if (url.indexOf("?") > -1) {
            url = url + "&timestamp=" + getTimestamp
        } else {
            url = url + "?timestamp=" + getTimestamp
        }
        return url;
    };

    function zkuiEncrypt(message, aseKey){
        var encrypt = CryptoJS.AES.encrypt(message, CryptoJS.enc.Utf8.parse(aseKey), {
            mode: CryptoJS.mode.ECB,
            padding: CryptoJS.pad.Pkcs7
        }).toString();
        return encrypt;
    }

    function encryptForm() {
        var userName=document.getElementById("username").value;
        var passwd =document.getElementById("password").value;
        var userNameEncrypt=zkuiEncrypt(userName,"ailk!QAZ@#$)IY&^");
        var passwdEncrypt=zkuiEncrypt(passwd,"ailk!QAZ@#$)IY&^");
        document.getElementById("username").value=userNameEncrypt;
        document.getElementById("password").value=passwdEncrypt;
        console.info('username: %o, passwd: %o',userNameEncrypt,passwdEncrypt);
        return true;
    }
</script>